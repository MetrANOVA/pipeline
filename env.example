# =============================================================================
# MetrANOVA Pipeline Configuration
# =============================================================================
# Copy this file to .env and customize the values for your environment.
# 
# Note: Some variables like PIPELINE_TYPE and processor configurations are 
# typically set in docker-compose.yml environment sections rather than .env
# because they define the specific role of each container instance.

# =============================================================================
# General Settings
# =============================================================================

# Enable debug logging (set to true for detailed logs)
DEBUG=false

# =============================================================================
# ClickHouse Configuration
# =============================================================================

# ClickHouse server connection
CLICKHOUSE_HOST=localhost
CLICKHOUSE_PORT=8123
CLICKHOUSE_DATABASE=default
CLICKHOUSE_USERNAME=default
CLICKHOUSE_PASSWORD=

# Enable HTTPS connection to ClickHouse (true/false)
CLICKHOUSE_SECURE=false

# ClickHouse table names for different data types
CLICKHOUSE_FLOW_TABLE=flow_edge
CLICKHOUSE_IF_TRAFFIC_TABLE=if_traffic
CLICKHOUSE_IF_SAP_QUEUE_TABLE=if_sap_queue
CLICKHOUSE_IF_PORT_QUEUE_TABLE=if_port_queue
CLICKHOUSE_RAW_KAFKA_TABLE=raw_kafka_messages

# ClickHouse table names for interface metadata
# CLICKHOUSE_IF_METADATA_TABLE is used by multiple pipelines:
# - metadata_export_pipeline: The InterfaceMetadataProcessor uses this 
#   as the target table where it writes interface metadata
# - interface_pipeline: The interface processors use this as the name 
#   of the Redis table to lookup refs to ClickHouse entries in the table 
#   of the same name. 
# The variable is NOT used by the metadata_import_pipeline but you will 
# likely want CLICKHOUSE_CONSUMER_TABLES to include the value in its list 
# of values so the references get properly updated.
# 
CLICKHOUSE_IF_METADATA_TABLE=meta_if

# ClickHouse batch processing settings
CLICKHOUSE_BATCH_SIZE=1000
CLICKHOUSE_BATCH_TIMEOUT=30.0
CLICKHOUSE_FLUSH_INTERVAL=0.1

# ClickHouse consumer settings (for metadata pipelines)
CLICKHOUSE_CONSUMER_UPDATE_INTERVAL=600
CLICKHOUSE_CONSUMER_TABLES=meta_if,meta_esdb_ipsvc

# ClickHouse cacher settings
CLICKHOUSE_CACHER_TABLES=meta_if

# Interface metadata settings
CLICKHOUSE_IF_METADATA_FORCE_UPDATE=false

# Interface queue processor settings
CLICKHOUSE_IF_PORT_QUEUE_MIN=1
CLICKHOUSE_IF_PORT_QUEUE_MAX=16
CLICKHOUSE_IF_SAP_QUEUE_MIN=1
CLICKHOUSE_IF_SAP_QUEUE_MAX=16

# =============================================================================
# Kafka Configuration
# =============================================================================

# Kafka connection settings
KAFKA_BOOTSTRAP_SERVERS=localhost:9092
KAFKA_TOPIC=metranova_flow
KAFKA_CONSUMER_GROUP=ch_writer_group_default

# SSL Certificate paths (set these if using SSL)
KAFKA_SSL_CA_LOCATION=/app/certificates/kafka_ca.crt
KAFKA_SSL_CERTIFICATE_LOCATION=/app/certificates/kafka_user.crt
KAFKA_SSL_KEY_LOCATION=/app/certificates/kafka_user.key
KAFKA_SSL_KEY_PASSWORD=

# Kafka consumer tuning parameters
# KAFKA_AUTO_OFFSET_RESET=latest
# KAFKA_ENABLE_AUTO_COMMIT=true
# KAFKA_AUTO_COMMIT_INTERVAL_MS=5000
# KAFKA_SESSION_TIMEOUT_MS=30000
# KAFKA_HEARTBEAT_INTERVAL_MS=10000
# KAFKA_MAX_POLL_INTERVAL_MS=300000
# KAFKA_FETCH_MIN_BYTES=1
# KAFKA_FETCH_MAX_BYTES=52428800
# KAFKA_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM=https

# =============================================================================
# Redis Configuration
# =============================================================================

# Redis connection settings
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# Redis consumer settings (for metadata export pipeline)
REDIS_CONSUMER_UPDATE_INTERVAL=600
REDIS_CONSUMER_TABLES=meta_if_cache

# Redis interface metadata settings (for metadata import pipeline)
REDIS_IF_METADATA_TABLE=meta_if_cache
REDIS_IF_METADATA_EXPIRES=86400

# =============================================================================
# Pipeline Configuration (Usually set in docker-compose.yml)
# =============================================================================
# 
# These variables are typically set in the docker-compose.yml environment
# section rather than in .env because they define the specific role and
# behavior of each container instance:
#
# PIPELINE_TYPE - Determines which pipeline to run:
#   - json: Output Kafka messages as JSON (debugging)
#   - clickhouse: Process and store data in ClickHouse
#   - metadata_import: Import metadata from ClickHouse to Redis
#   - metadata_export: Export metadata from Redis to ClickHouse
#
# CLICKHOUSE_PROCESSORS - Comma-separated list of ClickHouse processor classes:
#   - metranova.processors.clickhouse.flow.FlowProcessor
#   - metranova.processors.clickhouse.interface.InterfaceTrafficProcessor
#   - metranova.processors.clickhouse.interface.InterfaceSAPQueueProcessor
#   - metranova.processors.clickhouse.interface.InterfacePortQueueProcessor
#   - metranova.processors.clickhouse.interface.InterfaceMetadataProcessor
#   - metranova.processors.clickhouse.raw_kafka.RawKafkaProcessor
#
# REDIS_PROCESSORS - Comma-separated list of Redis processor classes:
#   - metranova.processors.redis.interface.InterfaceMetadataProcessor
#
# Example docker-compose.yml environment section:
#   environment:
#     - PIPELINE_TYPE=clickhouse
#     - CLICKHOUSE_PROCESSORS=metranova.processors.clickhouse.flow.FlowProcessor
#     - KAFKA_TOPIC=metranova_flow